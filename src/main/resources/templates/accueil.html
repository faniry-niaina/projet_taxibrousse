<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Taxi Brousse - Accueil</title>
    
    <link th:href="@{/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
</head>
<body>
<div class="container py-4">

    <h1 class="mb-4">Bienvenue chez Taxi Brousse</h1>

    <!-- Messages -->
    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Filtre -->
    <form th:action="@{/filtrer}" method="post" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" name="date" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="departId" class="form-label">Gare de départ</label>
            <select id="departId" name="departId" class="form-select">
                <option value="">-- Toutes --</option>
                <option th:each="gare : ${gares}" th:value="${gare.id}" th:text="${gare.nom}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="arriveId" class="form-label">Gare d'arrivée</label>
            <select id="arriveId" name="arriveId" class="form-select">
                <option value="">-- Toutes --</option>
                <option th:each="gare : ${gares}" th:value="${gare.id}" th:text="${gare.nom}"></option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Filtrer</button>
        </div>
    </form>
    <a th:href="@{/}" class="btn btn-secondary mb-4">Réinitialiser</a>

    <!-- Liste des voyages -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Matricule</th>
            <th>Trajet</th>
            <th>Date</th>
            <th>Durée (h)</th>
            
            <th>Places Standard</th>
            <th>Places VIP</th>
            <th>Total Restant</th>
            <th>CA Actuel (Ar)</th>
            <th>CA Max (Ar)</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="voyage : ${voyages}">
            <td th:text="${voyage.voiture.matricule}"></td>
            <td th:text="${voyage.trajet.depart.nom} + ' → ' + ${voyage.trajet.arrive.nom}"></td>
            <td th:text="${#temporals.format(voyage.dateHeure, 'dd/MM/yyyy')}"></td>
            <td th:text="${voyage.dureVoyage}"></td>
            <td>
                <span th:text="${voyage.placesStandardRestantes}" th:class="${voyage.placesStandardRestantes > 0 ? 'text-success' : 'text-danger'}"></span>
            </td>
            <td>
                <span th:text="${voyage.placesVipRestantes}" th:class="${voyage.placesVipRestantes > 0 ? 'text-success' : 'text-danger'}"></span>
            </td>
            <td>
                <span th:text="${voyage.placesRestantes}" th:class="${voyage.placesRestantes > 0 ? 'badge bg-primary' : 'badge bg-danger'}"></span>
            </td>
            <td>
                <span th:text="${#numbers.formatDecimal(voyage.chiffreAffairesActuel, 0, 'POINT', 0, 'POINT')}" class="fw-bold text-success"></span>
            </td>
            <td>
                <span th:text="${#numbers.formatDecimal(voyage.chiffreAffairesMax, 0, 'POINT', 0, 'POINT')}" class="fw-bold text-info"></span>
            </td>
            <td>
                <a th:if="${voyage.placesRestantes > 0}" th:href="@{/reservation/{id}(id=${voyage.id})}" class="btn btn-success btn-sm">Réserver</a>
                <span th:if="${voyage.placesRestantes == 0}" class="text-danger">Complet</span>
            </td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>