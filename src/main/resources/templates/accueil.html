<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Taxi Brousse - Accueil</title>
    
    <link th:href="@{/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
</head>
<body>
<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Bienvenue chez Taxi Brousse</h1>
        <div>
            <a th:href="@{/chiffre-affaire}" class="btn btn-success">ðŸ’° Chiffre d'Affaire</a>
            <a th:href="@{/factures}" class="btn btn-warning">ðŸ“‹ Factures PublicitÃ©s</a>
            <a th:href="@{/publicites}" class="btn btn-info">ðŸ“¢ Gestion des PublicitÃ©s</a>
        </div>
    </div>

    <!-- Messages -->
    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Filtre -->
    <form th:action="@{/filtrer}" method="post" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" name="date" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="departId" class="form-label">Gare de dÃ©part</label>
            <select id="departId" name="departId" class="form-select">
                <option value="">-- Toutes --</option>
                <option th:each="gare : ${gares}" th:value="${gare.id}" th:text="${gare.nom}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="arriveId" class="form-label">Gare d'arrivÃ©e</label>
            <select id="arriveId" name="arriveId" class="form-select">
                <option value="">-- Toutes --</option>
                <option th:each="gare : ${gares}" th:value="${gare.id}" th:text="${gare.nom}"></option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Filtrer</button>
        </div>
    </form>
    <a th:href="@{/}" class="btn btn-secondary mb-4">RÃ©initialiser</a>

    <!-- Liste des voyages -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Matricule</th>
            <th>Trajet</th>
            <th>Date</th>
            <th>DurÃ©e (h)</th>
            <th>Places par type</th>
            <th>Total Restant</th>
            <th>CA Actuel (Ar)</th>
            <th>CA Max (Ar)</th>
            <th>Action</th>
        </tr>
        </theconad>
        <tbody>
        <tr th:each="voyage : ${voyages}">
            <td th:text="${voyage.voiture.matricule}"></td>
            <td th:text="${voyage.trajet.depart.nom} + ' â†’ ' + ${voyage.trajet.arrive.nom}"></td>
            <td th:text="${#temporals.format(voyage.dateHeure, 'dd/MM/yyyy HH:mm')}"></td>
            <td th:text="${voyage.dureVoyage}"></td>
            <td>
                <div th:each="place : ${voyage.placesParType}" class="mb-1">
                    <span th:text="${place.libelle}" class="fw-bold"></span> : 
                    <span th:text="${place.restantes}" th:class="${place.restantes > 0 ? 'text-success fw-bold' : 'text-danger fw-bold'}"></span>
                    <span class="text-muted">/ <span th:text="${place.total}"></span></span>
                </div>
            </td>
            <td>
                <span th:text="${voyage.placesRestantes}" th:class="${voyage.placesRestantes > 0 ? 'badge bg-primary' : 'badge bg-danger'}"></span>
                <span class="text-muted">/ <span th:text="${voyage.voiture.capacite}"></span></span>
            </td>
            <td>
                <span th:text="${#numbers.formatDecimal(voyage.chiffreAffairesActuel, 0, 'POINT', 0, 'POINT')}" class="fw-bold text-success"></span>
            </td>
            <td>
                <span th:text="${#numbers.formatDecimal(voyage.chiffreAffairesMax, 0, 'POINT', 0, 'POINT')}" class="fw-bold text-info"></span>
            </td>
            <td>
                <a th:if="${voyage.placesRestantes > 0}" th:href="@{/reservation/{id}(id=${voyage.id})}" class="btn btn-success btn-sm">RÃ©server</a>
                <span th:if="${voyage.placesRestantes == 0}" class="text-danger">Complet</span>
            </td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>